# README для WebAPI

## Описание проекта

Этот проект представляет собой RESTful API на платформе ASP.NET Core, использующий Entity Framework Core для работы с базой данных PostgreSQL. Он предназначен для управления узлами (Nodes) и ведения журнала исключений (ExceptionLog). API позволяет создавать, читать и обрабатывать узлы с возможностью логирования ошибок.

## Структура проекта

- **Models**: Содержит модели данных, такие как `Node`, `Tree` и `ExceptionLog`.
- **Data**: Содержит контекст базы данных `ApplicationDbContext`.
- **Controllers**: Содержит контроллеры, такие как `NodesController`, для обработки HTTP-запросов.
- **Exceptions**: Содержит пользовательские исключения, такие как `SecureException`.

## Установка и настройка

### Шаг 1: Установка необходимых инструментов

Убедитесь, что у вас установлены:
- Visual Studio 2022 или выше.
- .NET 6 SDK.
- PostgreSQL (или используемая вами база данных) на вашем компьютере.

### Шаг 2: Создание нового проекта

1. Откройте Visual Studio и создайте новый проект типа "ASP.NET Core Web API".
2. Убедитесь, что выбран .NET 6 и отключена аутентификация.
3. Нажмите "Создать".

### Шаг 3: Установка NuGet пакетов

Откройте `Package Manager Console` и выполните следующие команды:

```bash
Install-Package Npgsql.EntityFrameworkCore.PostgreSQL
Install-Package Microsoft.EntityFrameworkCore.Tools
```

### Шаг 4: Настройка подключения к базе данных

В файле `appsettings.json` добавьте строку подключения:

```json
{
  "ConnectionStrings": {
    "DefaultConnection": "Host=your_host;Database=your_database;Username=your_username;Password=your_password"
  }
}
```

### Шаг 5: Настройка контекста базы данных

В `Program.cs` добавьте конфигурацию для контекста базы данных:

```csharp
builder.Services.AddDbContext<ApplicationDbContext>(options =>
    options.UseNpgsql(builder.Configuration.GetConnectionString("DefaultConnection")));
```

### Шаг 6: Создание миграций и обновление базы данных

Выполните команды для создания и применения миграций:

```bash
Add-Migration InitialCreate
Update-Database
```

### Шаг 7: Запуск приложения

Нажмите `F5` или выберите `Debug -> Start Debugging` для запуска приложения.

## Использование Swagger для тестирования API

1. Перейдите по адресу `https://localhost:{port}/swagger` для доступа к интерфейсу Swagger.
2. Используйте интерфейс для тестирования API-методов, таких как создание узлов.

## Устранение проблем с безопасным соединением

Если вы получаете сообщение "Невозможно установить безопасное соединение", убедитесь, что вы используете правильный URL с HTTPS. Для локальной разработки может потребоваться добавить исключение для сертификата в вашем браузере.

### Примечания по тестированию в Swagger

Если браузер не открывает HTTPS, попробуйте:

- Открыть Swagger через другой браузер.
- Использовать Postman для тестирования API.

## Пример запроса на создание узла

Пример тела запроса для создания узла:

```json
{
  "name": "Node1",
  "treeId": 1
}
```

## Логирование исключений

Все исключения, произошедшие во время обработки запросов, будут записываться в базе данных в таблице `ExceptionLogs`. Структура записи включает уникальный идентификатор события, временную метку, параметры запроса и трассировку стека.

## Заключение

Этот проект представляет собой базовый шаблон для работы с RESTful API на ASP.NET Core. Вы можете расширять функциональность, добавлять новые модели и контроллеры по мере необходимости.

Программист-разработчик Меркулов Е. В. 2025
